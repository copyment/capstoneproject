<!--------- BORROWED COLLECTION E --------->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./csss/profilecss.css">
</head>

<body>
    <!-------- PAGE HEADER START -------->
    <header>
        <nav>
            <div class="logo-search">
                <img href="/home" src="./LOGO/ld white.png" class="logos">
                <div class="icon">
                    <a href="/bookmarks"><i class="fa-solid fa-bookmark"></i></a>
                </div>
            </div>
            <ul>
                <li><a href="/home">HOME</a></li>
                <li><a href="/bcollection">ITEMS</a></li>
            </ul>
        </nav>
    </header>
    <!-------- PAGE HEADER END -------->

    <!--------- SIDE MENU S --------->
    <section class="hero">
        <div class="side-bar" id="sidebar">
            <h4><i class="fa-solid fa-bars"> </i>USER</h4>
            <ul>
                <li style="background-color:  rgb(83, 241, 151);">
                    <i class="fa-solid"></i>
                    <a href="/profile">My Profile</a>
                </li>
                <li>
                    <i class="fa-solid"></i>
                    <a href="/myborrow">My Borrowed</a>
                </li>
                <li>
                    <i class="fa-solid"></i>
                    <a href="/myreserved">My Request</a>
                </li>
                <li>
                    <i class="fa-solid"></i>
                        <a href="/mytransaction">My Penalties</a>
                </li>
                <li>
                    <i class="fa-solid"></i>
                    <a href="/FRONT">Log Out</a>
                </li>
            </ul>
        </div>
    </section>
    <!--------- SIDE MENU E --------->

    <!--------- USER INFORMATION S --------->
    <section class="sec-2">
         <div class="content">
             <div class="titile">
                <h4> MY PROFILE </h4>
            </div>
            <div class="profile-container">
                <form action="/update-profile" method="POST" enctype="multipart/form-data">
                    <div class="profile-picture">
                        <img src="data:image/jpeg;base64,{{ user.ProfilePicture }}" alt="Profile Picture" id="currentProfilePicture">
                        <input type="file" id="file" name="profilePicture" accept="image/*">
                        <label for="file" id="uploadbtn"><i class="fa-solid fa-camera"></i></label>
                    </div>


                    <div class="profile-info">
                        <h2>{{ user.Fullname }}</h2>
                        <p>{{user.AccountType}} ({{ user.IDNumber }})</p> <h3></h3>
                    </div>

                    <div class="profile-details">
                        <div class="detail-box2">
                            <h4>Birthday</h4>
                            <p>{{ formattedBirthday }}</p>
                        </div>
                        <div class="detail-box2">
                            <h4>RFID</h4>
                            <p>{{ user.Rfid }}</p>
                        </div>
                        <div class="detail-box">
                            <h4>Contact Number</h4>
                            <input type="number" id="contact" name="contact" value="{{ user.ContactNumber }}" disabled>
                        </div>
                        <div class="detail-box">
                            <h4>Email</h4>
                            <input type="text" id="email" name="email" value="{{ user.Email }}" disabled>
                        </div>
                        <div class="detail-box">
                            <h4>Username</h4>
                            <input type="text" id="username" name="username" value="{{ user.Username }}" disabled>
                        </div>
                        <div class="detail-box">
                            <h4>Password</h4>
                            <input type="password" id="password" name="password" value="{{ user.Password }}" disabled>
                        </div>
                        <div class="detail-box">
                            <h4>Address</h4>
                            <input type="text" id="address" name="address" value="{{ user.Address }}" disabled>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="saveButton" class="save-btn" type="submit" style="display: none;">Save Changes</button>
                        <button id="cancelButton" class="cancel-btn" type="button" style="display: none;">Cancel</button>
                    </div>
                    <button class="edit-btn" id="editButton" type="button">Edit Profile</button>
                </form>
            </div>
        </div>
    </section>
    <!--------- USER INFORMATION E --------->


<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const editButton = document.getElementById('editButton');
        const saveButton = document.getElementById('saveButton');
        const inputFields = document.querySelectorAll('.detail-box input:not([id="account"])');
        const uploadButton = document.getElementById('uploadbtn');
        const profilePicture = document.getElementById('currentProfilePicture');
        const fileInput = document.getElementById('file');

        editButton.addEventListener('click', () => {
            inputFields.forEach(input => {
                input.disabled = !input.disabled;
            });
            saveButton.style.display = saveButton.style.display === 'none' ? 'block' : 'none';
            editButton.style.display = editButton.style.display === 'none' ? 'block' : 'none';
            cancelButton.style.display = cancelButton.style.display === 'none' ? 'block' : 'none';
            uploadButton.style.display = 'block';
        });
            cancelButton.addEventListener('click', () => {
            // Reload the page to discard changes
            window.location.reload();
        });

        // Listen for changes in the file input
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    // Update the 'src' attribute of the image with the selected file
                    profilePicture.src = e.target.result;
                };
                // Read the file as a data URL
                reader.readAsDataURL(file);
            }
        });
        // Function to handle form submission for profile update
            document.getElementById('saveButton').addEventListener('click', async function (event) {
                event.preventDefault(); // Prevent default form submission

                const confirmed = await Swal.fire({
                    title: "Are you sure?",
                    text: "Do you want to save the changes?",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, Save it!"
                });

                if (confirmed.isConfirmed) {
                    try {
                        const formData = new FormData(document.querySelector('form'));
                        const response = await fetch('/update-profile', {
                            method: 'POST',
                            body: formData
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.message === "update saved successfully") {
                                Swal.fire('Success!', 'Your update has been processed.', 'success')
                                    .then(() => {
                                        window.location.href = '/profile';
                                    });
                            } else if (data.message === "Contact Number already exists. Please try another!") {
                                Swal.fire({
                                    title: "Failed!",
                                    text: "Contact Number already exists. Please try another!",
                                    icon: "error"
                                });
                            } else if (data.message === "Email already exists. Please try another!") {
                                Swal.fire({
                                    title: "Failed!",
                                    text: "Email already exists. Please try another!",
                                    icon: "error"
                                });
                            } else if (data.message === "Username already exists. Please try another!") {
                                Swal.fire({
                                    title: "Failed!",
                                    text: "Username already exists. Please try another!",
                                    icon: "error"
                                });
                            }
                        } else {
                            Swal.fire({
                                title: "Failedz!",
                                text: "An unexpectedz error occurred.",
                                icon: "error"
                            });
                        }
                    } catch (error) {
                        // Catch any unexpected errors during the update process
                        console.error("Error:", error);
                        Swal.fire({
                            title: "Faileds!",
                            text: "An unexpected error occurred.",error,
                            icon: "error"
                        });
                    }
                }
            });

            });

            
</script>


<!-- ... (remaining HTML code) -->

    
</body>
</html>